<%= render(partial: 'reviews/navbar', locals: {page: "navigation", record: @record, user_email: current_user.email }) %>

<!-- everything below the nav -->
<section class="record_review_data">
  <div class="outer_flexbox">
    <!-- container of metadata sections -->
    <div class="section_container outer_flex_item_left">
      <!-- header for sections -->
      <div class="section_header">
        <h3>METADATA ELEMENTS</h3>
      </div>

      <!-- two coulmns holder -->
      <div class="flex_container">
        <!-- left column of section details -->
        <div class="flex_column">
        <% @record_sections.each_with_index do |section, index_count| %>
          <% if index_count.to_i % 3 == 0 %>
          <%= render(partial: 'collection_section_details', locals: {section: section, index_count: index_count, bubble_data: @bubble_data}) %>
          <% end %>
        <% end %>

          
        </div>

        <!-- right column of section details -->
        <div class="flex_column">
          <% @record_sections.each_with_index do |section, index_count| %>
            <% if index_count.to_i % 3 == 1 %>
            <%= render(partial: 'collection_section_details', locals: {section: section, index_count: index_count, bubble_data: @bubble_data}) %>
            <% end %>
          <% end %>
        </div>


        <!-- right column of section details -->
        <div class="flex_column">
          <% @record_sections.each_with_index do |section, index_count| %>
            <% if index_count.to_i % 3 == 2 %>
            <%= render(partial: 'collection_section_details', locals: {section: section, index_count: index_count, bubble_data: @bubble_data}) %>
            <% end %>
          <% end %>
        </div>
      </div>

    </div>

    <!-- right side completion/reviewers metrics -->
    <div class="outer_flex_item_right">
      <div class="review_comments">
        <!-- header for sections -->
        <div class="section_header">
          <h3>Review Comments</h3>
        </div>

        <% if !@user_review.completed? && !@marked_done %>
          <br>
          <p>
            <strong>Complete Review Comment:</strong>
          </p>

          <%= form_for @user_review, html: {id: :review_form} do |f| %>
            <%= f.hidden_field :record_id, { :value => @user_review.record_id } %>
            <%= f.hidden_field :id, { :value => @user_review.id } %>
            <%= f.hidden_field :user_id, { :value => @user_review.user_id } %>
            <%= f.hidden_field :review_state, { :value => 1 } %>
            <%= f.text_area :comment, html: {id: :review_comment} %>

            <script type="text/javascript">
              document.getElementById("review_comment").oninput = function() {
                document.getElementById("review_complete_button").disabled = false;
              }
            </script>
          <% end %>



        <% end %>

        <% if @marked_done %>
          <p class="completed_notice">
            <strong>Review Has Been Completed and Closed</strong>
          </p>
        <% end %>

        <% @reviews.each do |review| %>
          <div class="single_comment">
            <p><strong>Reviewer: <%=review.user.email%></strong></p>
            <p><%=review.formatted_date%></p>
            <p><%=string_html_format(review.comment)%></p>
          </div>
        <% end %>

      </div>
    </div>

  </div>


  <%= render(partial: 'reviews/legend') %>
  
</section>