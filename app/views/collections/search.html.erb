<div class="page_header">
  <h1>Metadata Curation: Search</h1>
</div>

<p>Search the CMR:</p>

<p style="font-size:0.8em;">Search Text &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DAAC</p>
<%= form_tag(collections_search_path, method: "get") do %>
  <%= text_field_tag(:free_text) %>
  <%= hidden_field_tag(:curr_page, "1") %>
  <%= select_tag(:provider, options_for_select(@provider_select_list, :selected => @provider)) %>
  <%= submit_tag("Search") %>
<% end %>

<br>
<br>

<% unless @search_iterator.nil? %>
  <% unless @search_iterator.empty? %>

    <p>Search Results</p>
    <p>Search Phrase = <%= @free_text.to_s %></p>
    <p>Total Results = <%= @collection_count %></p>
      <table cellpadding="5" border="1">
          <tr>
              <th>Results #</th>
              <th>Concept_ID</th>
              <th>Revision_ID</th>
              <th>ShortName</th>
              <th>Selection</th>
          </tr>

          

        <% @search_iterator.each_with_index do |result, index| %>
          <tr>
              <td><%= (@curr_page.to_i - 1) * 10 + index + 1 %></td>
              <td id="concept<%= index.to_s %>"><%= result["concept_id"] %></td>
              <td id="revision<%= index.to_s %>"><%= result["revision_id"] %></td>
              <td><%= result["Collection"]["ShortName"] %></td>
              <td><input type="radio" id="search<%= index.to_s %>" name="searchSelection" value="<%= index.to_s %>"/></td>
          </tr>
        <% end %>
      </table>
      <br>

      <% if @curr_page.to_i > 1 %>
        <%= link_to "previous page", collections_search_path(free_text: @free_text, provider: @provider, curr_page: (@curr_page.to_i - 1).to_s) %>
      <% end %>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

      <% if @curr_page.to_i * 10 < @collection_count %>
        <%= link_to "next page", collections_search_path(free_text: @free_text, provider: @provider, curr_page: (@curr_page.to_i + 1).to_s)  %>
      <% end %>
    <% else %>  
      <p>No Search Results Found</p>
    <% end %>
<% end %>

<br>
<br>

<%= form_tag( new_collection_path ,  {method: "get", id: 'ingest_form'}) do %>
  <%= hidden_field_tag(:concept_id, "") %>
  <%= hidden_field_tag(:revision_id, "") %>
  <%= submit_tag("Select Collection", id: 'ingest_submit') %>
<% end %>


<script type="text/javascript">

  var ingestButton = document.getElementById("ingest_submit");
  ingestButton.disabled = true;

  var searchSelector = document.getElementsByName("searchSelection");

  for (var i = 0, length = searchSelector.length; i < length; i++) {
      (function(index) {
          var temp = document.getElementById("search" + i);
          temp.onclick = function() {
                                var count = index;
                                updateSelection(count);
                                ingestButton.disabled = false;
                                }
      })(i);
  }

  var updateSelection = function(count) {
    var rowName = "concept" + count;
    var newConceptId = document.getElementById(rowName).innerHTML;
    document.getElementById("concept_id").value = newConceptId;

    var rowNameRevision = "revision" + count;
    var newRevisionId = document.getElementById(rowNameRevision).innerHTML;
    document.getElementById("revision_id").value = newRevisionId;
  }



</script>


