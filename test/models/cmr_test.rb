require 'test_helper'

class CmrTest < ActiveSupport::TestCase

  describe "get_collections" do
    it "correctly gets collection from CMR api" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000020-LANCEAMSR2").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>9</took><result concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"8\" format=\"application/echo10+xml\">\n<Collection>\n<ShortName>A2_DySno_NRT</ShortName>\n<VersionId>0</VersionId>\n<InsertTime>2015-05-01T13:26:43Z</InsertTime>\n<LastUpdate>2015-09-14T13:26:43Z</LastUpdate>\n<LongName>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS</LongName>\n<DataSetId>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0</DataSetId>\n<Description>The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.</Description>\n<CollectionDataType>NEAR_REAL_TIME</CollectionDataType>\n<Orderable>false</Orderable>\n<Visible>true</Visible>\n<ProcessingLevelId>3</ProcessingLevelId>\n<ArchiveCenter>GHRC</ArchiveCenter>\n<CitationForExternalPublication>Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</CitationForExternalPublication><Price>0.0</Price><SpatialKeywords>\n<Keyword>GLOBAL</Keyword></SpatialKeywords><TemporalKeywords>\n<Keyword>DAILY</Keyword></TemporalKeywords><Temporal><RangeDateTime>\n<BeginningDateTime>2015-05-01T00:00:00Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact>\n<Role>GHRC USER SERVICES</Role><OrganizationEmails>\n<Email>ghrc-dmg@itsc.uah.edu</Email></OrganizationEmails></Contact></Contacts><ScienceKeywords><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>CRYOSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>TERRESTRIAL HYDROSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform>\n<ShortName>GCOM-W1</ShortName>\n<LongName>GCOM-W1</LongName>\n<Type>SATELLITE</Type><Instruments><Instrument>\n<ShortName>AMSR2</ShortName><Sensors><Sensor>\n<ShortName>AMSR2</ShortName></Sensor></Sensors></Instrument></Instruments></Platform></Platforms>\n<AdditionalAttributes>\n<AdditionalAttribute>\n<Name>identifier_product_doi</Name>\n<DataType>STRING</DataType>\n<Description>product DOI</Description>\n<Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n</AdditionalAttribute>\n<AdditionalAttribute>\n<Name>identifier_product_doi_authority</Name>\n<DataType>STRING</DataType>\n<Description>DOI authority</Description>\n<Value>http://dx.doi.org</Value>\n</AdditionalAttribute>\n</AdditionalAttributes>\n<Campaigns><Campaign>\n<ShortName>LANCE</ShortName></Campaign></Campaigns><OnlineAccessURLs><OnlineAccessURL>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><URLDescription></URLDescription><MimeType></MimeType></OnlineAccessURL></OnlineAccessURLs><OnlineResources><OnlineResource>\n<URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><Description></Description>\n<Type>Alternate Data Access</Type></OnlineResource><OnlineResource>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/</URL><Description></Description>\n<Type>Browse</Type></OnlineResource><OnlineResource>\n<URL>https://worldview.earthdata.nasa.gov/</URL><Description></Description>\n<Type>Worldview Imagery</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/</URL><Description></Description>\n<Type>Homepage</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf</URL><Description></Description>\n<Type>Guide</Type></OnlineResource><OnlineResource>\n<URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL><Description></Description>\n<Type>DOI</Type></OnlineResource><OnlineResource>\n<URL>http://ghrc.nsstc.nasa.gov/uso/citation.html</URL><Description></Description>\n<Type>Citing GHRC Data</Type></OnlineResource></OnlineResources><AssociatedDIFs><DIF>\n<EntryId>A2_DySno_NRT</EntryId></DIF></AssociatedDIFs><Spatial><SpatialCoverageType>Horizontal</SpatialCoverageType><HorizontalSpatialDomain><Geometry>\n<CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle>\n<WestBoundingCoordinate>-180</WestBoundingCoordinate>\n<NorthBoundingCoordinate>90</NorthBoundingCoordinate>\n<EastBoundingCoordinate>180</EastBoundingCoordinate>\n<SouthBoundingCoordinate>-90</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain>\n<GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation></Spatial>\n<MetadataStandardName>ECHO</MetadataStandardName>\n<MetadataStandardVersion>10</MetadataStandardVersion>\n</Collection></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")

      assert_equal(collection, {"ShortName"=>"A2_DySno_NRT", "VersionId"=>"0", "InsertTime"=>"2015-05-01T13:26:43Z", "LastUpdate"=>"2015-09-14T13:26:43Z", "LongName"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS", "DataSetId"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0", "Description"=>"The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.", "CollectionDataType"=>"NEAR_REAL_TIME", "Orderable"=>"false", "Visible"=>"true", "ProcessingLevelId"=>"3", "ArchiveCenter"=>"GHRC", "CitationForExternalPublication"=>"Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "Price"=>"0.0", "SpatialKeywords/Keyword"=>"GLOBAL", "TemporalKeywords/Keyword"=>"DAILY", "Temporal/RangeDateTime/BeginningDateTime"=>"2015-05-01T00:00:00Z", "Contacts/Contact/Role"=>"GHRC USER SERVICES", "Contacts/Contact/OrganizationEmails/Email"=>"ghrc-dmg@itsc.uah.edu", "ScienceKeywords/ScienceKeyword0/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword0/TopicKeyword"=>"CRYOSPHERE", "ScienceKeywords/ScienceKeyword0/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword0/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "ScienceKeywords/ScienceKeyword1/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword1/TopicKeyword"=>"TERRESTRIAL HYDROSPHERE", "ScienceKeywords/ScienceKeyword1/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword1/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "Platforms/Platform/ShortName"=>"GCOM-W1", "Platforms/Platform/LongName"=>"GCOM-W1", "Platforms/Platform/Type"=>"SATELLITE", "Platforms/Platform/Instruments/Instrument/ShortName"=>"AMSR2", "Platforms/Platform/Instruments/Instrument/Sensors/Sensor/ShortName"=>"AMSR2", "AdditionalAttributes/AdditionalAttribute0/Name"=>"identifier_product_doi", "AdditionalAttributes/AdditionalAttribute0/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute0/Description"=>"product DOI", "AdditionalAttributes/AdditionalAttribute0/Value"=>"10.5067/AMSR2/A2_DySno_NRT", "AdditionalAttributes/AdditionalAttribute1/Name"=>"identifier_product_doi_authority", "AdditionalAttributes/AdditionalAttribute1/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute1/Description"=>"DOI authority", "AdditionalAttributes/AdditionalAttribute1/Value"=>"http://dx.doi.org", "Campaigns/Campaign/ShortName"=>"LANCE", "OnlineAccessURLs/OnlineAccessURL/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/URL"=>"https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/Type"=>"Alternate Data Access", "OnlineResources/OnlineResource1/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/", "OnlineResources/OnlineResource1/Type"=>"Browse", "OnlineResources/OnlineResource2/URL"=>"https://worldview.earthdata.nasa.gov/", "OnlineResources/OnlineResource2/Type"=>"Worldview Imagery", "OnlineResources/OnlineResource3/URL"=>"http://lance.nsstc.nasa.gov/", "OnlineResources/OnlineResource3/Type"=>"Homepage", "OnlineResources/OnlineResource4/URL"=>"http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf", "OnlineResources/OnlineResource4/Type"=>"Guide", "OnlineResources/OnlineResource5/URL"=>"http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "OnlineResources/OnlineResource5/Type"=>"DOI", "OnlineResources/OnlineResource6/URL"=>"http://ghrc.nsstc.nasa.gov/uso/citation.html", "OnlineResources/OnlineResource6/Type"=>"Citing GHRC Data", "AssociatedDIFs/DIF/EntryId"=>"A2_DySno_NRT", "Spatial/SpatialCoverageType"=>"Horizontal", "Spatial/HorizontalSpatialDomain/Geometry/CoordinateSystem"=>"CARTESIAN", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/WestBoundingCoordinate"=>"-180", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/NorthBoundingCoordinate"=>"90", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/EastBoundingCoordinate"=>"180", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/SouthBoundingCoordinate"=>"-90", "Spatial/GranuleSpatialRepresentation"=>"CARTESIAN", "MetadataStandardName"=>"ECHO", "MetadataStandardVersion"=>"10", "DatasetId"=>"", "DataFormat"=>""})

    end

    it "raises error when concept_id invalid" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=junk-name").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => '{"errors"=>{"error"=>"Concept-id [junk-name] is not valid."}}', :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})

      error = false
      begin
        collection = Cmr.get_collection("junk-name")
      rescue Cmr::CmrError
        error = true
      end

      assert_equal(error, true)
    end

    it "raises error when concept_id is not found" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000042-LANCEAMSR3").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => '<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>0</hits><took>21</took></results>', :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})

      error = false
      begin
        collection = Cmr.get_collection("C1000000042-LANCEAMSR3")
      rescue Cmr::CmrError
        error = true
      end

      assert_equal(error, true)
    end

    it "correctly flattens results from collection" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000020-LANCEAMSR2").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>9</took><result concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"8\" format=\"application/echo10+xml\">\n<Collection>\n<ShortName>A2_DySno_NRT</ShortName>\n<VersionId>0</VersionId>\n<InsertTime>2015-05-01T13:26:43Z</InsertTime>\n<LastUpdate>2015-09-14T13:26:43Z</LastUpdate>\n<LongName>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS</LongName>\n<DataSetId>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0</DataSetId>\n<Description>The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.</Description>\n<CollectionDataType>NEAR_REAL_TIME</CollectionDataType>\n<Orderable>false</Orderable>\n<Visible>true</Visible>\n<ProcessingLevelId>3</ProcessingLevelId>\n<ArchiveCenter>GHRC</ArchiveCenter>\n<CitationForExternalPublication>Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</CitationForExternalPublication><Price>0.0</Price><SpatialKeywords>\n<Keyword>GLOBAL</Keyword></SpatialKeywords><TemporalKeywords>\n<Keyword>DAILY</Keyword></TemporalKeywords><Temporal><RangeDateTime>\n<BeginningDateTime>2015-05-01T00:00:00Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact>\n<Role>GHRC USER SERVICES</Role><OrganizationEmails>\n<Email>ghrc-dmg@itsc.uah.edu</Email></OrganizationEmails></Contact></Contacts><ScienceKeywords><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>CRYOSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>TERRESTRIAL HYDROSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform>\n<ShortName>GCOM-W1</ShortName>\n<LongName>GCOM-W1</LongName>\n<Type>SATELLITE</Type><Instruments><Instrument>\n<ShortName>AMSR2</ShortName><Sensors><Sensor>\n<ShortName>AMSR2</ShortName></Sensor></Sensors></Instrument></Instruments></Platform></Platforms>\n<AdditionalAttributes>\n<AdditionalAttribute>\n<Name>identifier_product_doi</Name>\n<DataType>STRING</DataType>\n<Description>product DOI</Description>\n<Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n</AdditionalAttribute>\n<AdditionalAttribute>\n<Name>identifier_product_doi_authority</Name>\n<DataType>STRING</DataType>\n<Description>DOI authority</Description>\n<Value>http://dx.doi.org</Value>\n</AdditionalAttribute>\n</AdditionalAttributes>\n<Campaigns><Campaign>\n<ShortName>LANCE</ShortName></Campaign></Campaigns><OnlineAccessURLs><OnlineAccessURL>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><URLDescription></URLDescription><MimeType></MimeType></OnlineAccessURL></OnlineAccessURLs><OnlineResources><OnlineResource>\n<URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><Description></Description>\n<Type>Alternate Data Access</Type></OnlineResource><OnlineResource>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/</URL><Description></Description>\n<Type>Browse</Type></OnlineResource><OnlineResource>\n<URL>https://worldview.earthdata.nasa.gov/</URL><Description></Description>\n<Type>Worldview Imagery</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/</URL><Description></Description>\n<Type>Homepage</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf</URL><Description></Description>\n<Type>Guide</Type></OnlineResource><OnlineResource>\n<URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL><Description></Description>\n<Type>DOI</Type></OnlineResource><OnlineResource>\n<URL>http://ghrc.nsstc.nasa.gov/uso/citation.html</URL><Description></Description>\n<Type>Citing GHRC Data</Type></OnlineResource></OnlineResources><AssociatedDIFs><DIF>\n<EntryId>A2_DySno_NRT</EntryId></DIF></AssociatedDIFs><Spatial><SpatialCoverageType>Horizontal</SpatialCoverageType><HorizontalSpatialDomain><Geometry>\n<CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle>\n<WestBoundingCoordinate>-180</WestBoundingCoordinate>\n<NorthBoundingCoordinate>90</NorthBoundingCoordinate>\n<EastBoundingCoordinate>180</EastBoundingCoordinate>\n<SouthBoundingCoordinate>-90</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain>\n<GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation></Spatial>\n<MetadataStandardName>ECHO</MetadataStandardName>\n<MetadataStandardVersion>10</MetadataStandardVersion>\n</Collection></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")

      is_flat = true
      collection.each do |key, value|
        unless value.is_a? String
          is_flat = false
        end
      end

      assert_equal(is_flat, true)
      #asserting this so that it can be shown for next test that this key is normally available
      assert_equal((collection.keys.include? "Contacts/Contact/OrganizationEmails/Email"), true)
    end

    it "removes nil values from incoming records" do
      #changed response to <OrganizationEmails>\n<Email></Email></OrganizationEmails> to represent nil value
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000020-LANCEAMSR2").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>9</took><result concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"8\" format=\"application/echo10+xml\">\n<Collection>\n<ShortName>A2_DySno_NRT</ShortName>\n<VersionId>0</VersionId>\n<InsertTime>2015-05-01T13:26:43Z</InsertTime>\n<LastUpdate>2015-09-14T13:26:43Z</LastUpdate>\n<LongName>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS</LongName>\n<DataSetId>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0</DataSetId>\n<Description>The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.</Description>\n<CollectionDataType>NEAR_REAL_TIME</CollectionDataType>\n<Orderable>false</Orderable>\n<Visible>true</Visible>\n<ProcessingLevelId>3</ProcessingLevelId>\n<ArchiveCenter>GHRC</ArchiveCenter>\n<CitationForExternalPublication>Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</CitationForExternalPublication><Price>0.0</Price><SpatialKeywords>\n<Keyword>GLOBAL</Keyword></SpatialKeywords><TemporalKeywords>\n<Keyword>DAILY</Keyword></TemporalKeywords><Temporal><RangeDateTime>\n<BeginningDateTime>2015-05-01T00:00:00Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact>\n<Role>GHRC USER SERVICES</Role><OrganizationEmails>\n<Email></Email></OrganizationEmails></Contact></Contacts><ScienceKeywords><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>CRYOSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>TERRESTRIAL HYDROSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform>\n<ShortName>GCOM-W1</ShortName>\n<LongName>GCOM-W1</LongName>\n<Type>SATELLITE</Type><Instruments><Instrument>\n<ShortName>AMSR2</ShortName><Sensors><Sensor>\n<ShortName>AMSR2</ShortName></Sensor></Sensors></Instrument></Instruments></Platform></Platforms>\n<AdditionalAttributes>\n<AdditionalAttribute>\n<Name>identifier_product_doi</Name>\n<DataType>STRING</DataType>\n<Description>product DOI</Description>\n<Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n</AdditionalAttribute>\n<AdditionalAttribute>\n<Name>identifier_product_doi_authority</Name>\n<DataType>STRING</DataType>\n<Description>DOI authority</Description>\n<Value>http://dx.doi.org</Value>\n</AdditionalAttribute>\n</AdditionalAttributes>\n<Campaigns><Campaign>\n<ShortName>LANCE</ShortName></Campaign></Campaigns><OnlineAccessURLs><OnlineAccessURL>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><URLDescription></URLDescription><MimeType></MimeType></OnlineAccessURL></OnlineAccessURLs><OnlineResources><OnlineResource>\n<URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><Description></Description>\n<Type>Alternate Data Access</Type></OnlineResource><OnlineResource>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/</URL><Description></Description>\n<Type>Browse</Type></OnlineResource><OnlineResource>\n<URL>https://worldview.earthdata.nasa.gov/</URL><Description></Description>\n<Type>Worldview Imagery</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/</URL><Description></Description>\n<Type>Homepage</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf</URL><Description></Description>\n<Type>Guide</Type></OnlineResource><OnlineResource>\n<URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL><Description></Description>\n<Type>DOI</Type></OnlineResource><OnlineResource>\n<URL>http://ghrc.nsstc.nasa.gov/uso/citation.html</URL><Description></Description>\n<Type>Citing GHRC Data</Type></OnlineResource></OnlineResources><AssociatedDIFs><DIF>\n<EntryId>A2_DySno_NRT</EntryId></DIF></AssociatedDIFs><Spatial><SpatialCoverageType>Horizontal</SpatialCoverageType><HorizontalSpatialDomain><Geometry>\n<CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle>\n<WestBoundingCoordinate>-180</WestBoundingCoordinate>\n<NorthBoundingCoordinate>90</NorthBoundingCoordinate>\n<EastBoundingCoordinate>180</EastBoundingCoordinate>\n<SouthBoundingCoordinate>-90</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain>\n<GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation></Spatial>\n<MetadataStandardName>ECHO</MetadataStandardName>\n<MetadataStandardVersion>10</MetadataStandardVersion>\n</Collection></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")
      assert_equal((collection.keys.include? "Contacts/Contact/OrganizationEmails/Email"), false)
    end

    it "adds in required fields when nil" do
      #changed shortname to be == nil and shortname is always required
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000020-LANCEAMSR2").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>9</took><result concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"8\" format=\"application/echo10+xml\">\n<Collection>\n<ShortName></ShortName>\n<VersionId>0</VersionId>\n<InsertTime>2015-05-01T13:26:43Z</InsertTime>\n<LastUpdate>2015-09-14T13:26:43Z</LastUpdate>\n<LongName>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS</LongName>\n<DataSetId>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0</DataSetId>\n<Description>The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.</Description>\n<CollectionDataType>NEAR_REAL_TIME</CollectionDataType>\n<Orderable>false</Orderable>\n<Visible>true</Visible>\n<ProcessingLevelId>3</ProcessingLevelId>\n<ArchiveCenter>GHRC</ArchiveCenter>\n<CitationForExternalPublication>Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</CitationForExternalPublication><Price>0.0</Price><SpatialKeywords>\n<Keyword>GLOBAL</Keyword></SpatialKeywords><TemporalKeywords>\n<Keyword>DAILY</Keyword></TemporalKeywords><Temporal><RangeDateTime>\n<BeginningDateTime>2015-05-01T00:00:00Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact>\n<Role>GHRC USER SERVICES</Role><OrganizationEmails>\n<Email>ghrc-dmg@itsc.uah.edu</Email></OrganizationEmails></Contact></Contacts><ScienceKeywords><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>CRYOSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>TERRESTRIAL HYDROSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform>\n<ShortName>GCOM-W1</ShortName>\n<LongName>GCOM-W1</LongName>\n<Type>SATELLITE</Type><Instruments><Instrument>\n<ShortName>AMSR2</ShortName><Sensors><Sensor>\n<ShortName>AMSR2</ShortName></Sensor></Sensors></Instrument></Instruments></Platform></Platforms>\n<AdditionalAttributes>\n<AdditionalAttribute>\n<Name>identifier_product_doi</Name>\n<DataType>STRING</DataType>\n<Description>product DOI</Description>\n<Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n</AdditionalAttribute>\n<AdditionalAttribute>\n<Name>identifier_product_doi_authority</Name>\n<DataType>STRING</DataType>\n<Description>DOI authority</Description>\n<Value>http://dx.doi.org</Value>\n</AdditionalAttribute>\n</AdditionalAttributes>\n<Campaigns><Campaign>\n<ShortName>LANCE</ShortName></Campaign></Campaigns><OnlineAccessURLs><OnlineAccessURL>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><URLDescription></URLDescription><MimeType></MimeType></OnlineAccessURL></OnlineAccessURLs><OnlineResources><OnlineResource>\n<URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><Description></Description>\n<Type>Alternate Data Access</Type></OnlineResource><OnlineResource>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/</URL><Description></Description>\n<Type>Browse</Type></OnlineResource><OnlineResource>\n<URL>https://worldview.earthdata.nasa.gov/</URL><Description></Description>\n<Type>Worldview Imagery</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/</URL><Description></Description>\n<Type>Homepage</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf</URL><Description></Description>\n<Type>Guide</Type></OnlineResource><OnlineResource>\n<URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL><Description></Description>\n<Type>DOI</Type></OnlineResource><OnlineResource>\n<URL>http://ghrc.nsstc.nasa.gov/uso/citation.html</URL><Description></Description>\n<Type>Citing GHRC Data</Type></OnlineResource></OnlineResources><AssociatedDIFs><DIF>\n<EntryId>A2_DySno_NRT</EntryId></DIF></AssociatedDIFs><Spatial><SpatialCoverageType>Horizontal</SpatialCoverageType><HorizontalSpatialDomain><Geometry>\n<CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle>\n<WestBoundingCoordinate>-180</WestBoundingCoordinate>\n<NorthBoundingCoordinate>90</NorthBoundingCoordinate>\n<EastBoundingCoordinate>180</EastBoundingCoordinate>\n<SouthBoundingCoordinate>-90</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain>\n<GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation></Spatial>\n<MetadataStandardName>ECHO</MetadataStandardName>\n<MetadataStandardVersion>10</MetadataStandardVersion>\n</Collection></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")
      
      #same hardcoded result as unedited Cmr request, except with shortname changed to ""
      assert_equal(collection, {"ShortName"=>"", "VersionId"=>"0", "InsertTime"=>"2015-05-01T13:26:43Z", "LastUpdate"=>"2015-09-14T13:26:43Z", "LongName"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS", "DataSetId"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0", "Description"=>"The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.", "CollectionDataType"=>"NEAR_REAL_TIME", "Orderable"=>"false", "Visible"=>"true", "ProcessingLevelId"=>"3", "ArchiveCenter"=>"GHRC", "CitationForExternalPublication"=>"Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "Price"=>"0.0", "SpatialKeywords/Keyword"=>"GLOBAL", "TemporalKeywords/Keyword"=>"DAILY", "Temporal/RangeDateTime/BeginningDateTime"=>"2015-05-01T00:00:00Z", "Contacts/Contact/Role"=>"GHRC USER SERVICES", "Contacts/Contact/OrganizationEmails/Email"=>"ghrc-dmg@itsc.uah.edu", "ScienceKeywords/ScienceKeyword0/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword0/TopicKeyword"=>"CRYOSPHERE", "ScienceKeywords/ScienceKeyword0/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword0/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "ScienceKeywords/ScienceKeyword1/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword1/TopicKeyword"=>"TERRESTRIAL HYDROSPHERE", "ScienceKeywords/ScienceKeyword1/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword1/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "Platforms/Platform/ShortName"=>"GCOM-W1", "Platforms/Platform/LongName"=>"GCOM-W1", "Platforms/Platform/Type"=>"SATELLITE", "Platforms/Platform/Instruments/Instrument/ShortName"=>"AMSR2", "Platforms/Platform/Instruments/Instrument/Sensors/Sensor/ShortName"=>"AMSR2", "AdditionalAttributes/AdditionalAttribute0/Name"=>"identifier_product_doi", "AdditionalAttributes/AdditionalAttribute0/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute0/Description"=>"product DOI", "AdditionalAttributes/AdditionalAttribute0/Value"=>"10.5067/AMSR2/A2_DySno_NRT", "AdditionalAttributes/AdditionalAttribute1/Name"=>"identifier_product_doi_authority", "AdditionalAttributes/AdditionalAttribute1/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute1/Description"=>"DOI authority", "AdditionalAttributes/AdditionalAttribute1/Value"=>"http://dx.doi.org", "Campaigns/Campaign/ShortName"=>"LANCE", "OnlineAccessURLs/OnlineAccessURL/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/URL"=>"https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/Type"=>"Alternate Data Access", "OnlineResources/OnlineResource1/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/", "OnlineResources/OnlineResource1/Type"=>"Browse", "OnlineResources/OnlineResource2/URL"=>"https://worldview.earthdata.nasa.gov/", "OnlineResources/OnlineResource2/Type"=>"Worldview Imagery", "OnlineResources/OnlineResource3/URL"=>"http://lance.nsstc.nasa.gov/", "OnlineResources/OnlineResource3/Type"=>"Homepage", "OnlineResources/OnlineResource4/URL"=>"http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf", "OnlineResources/OnlineResource4/Type"=>"Guide", "OnlineResources/OnlineResource5/URL"=>"http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "OnlineResources/OnlineResource5/Type"=>"DOI", "OnlineResources/OnlineResource6/URL"=>"http://ghrc.nsstc.nasa.gov/uso/citation.html", "OnlineResources/OnlineResource6/Type"=>"Citing GHRC Data", "AssociatedDIFs/DIF/EntryId"=>"A2_DySno_NRT", "Spatial/SpatialCoverageType"=>"Horizontal", "Spatial/HorizontalSpatialDomain/Geometry/CoordinateSystem"=>"CARTESIAN", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/WestBoundingCoordinate"=>"-180", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/NorthBoundingCoordinate"=>"90", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/EastBoundingCoordinate"=>"180", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/SouthBoundingCoordinate"=>"-90", "Spatial/GranuleSpatialRepresentation"=>"CARTESIAN", "MetadataStandardName"=>"ECHO", "MetadataStandardVersion"=>"10", "DatasetId"=>"", "DataFormat"=>""})
    end
  end


  describe "collection_granule_count" do

    it "gets number of associated granules" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/granules.echo10?concept_id=C1000000020-LANCEAMSR2&page_num=1&page_size=10").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>29</hits><took>127</took><result concept-id=\"G1369618397-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"15\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170206.he5</GranuleUR>\n      <InsertTime>2017-02-07T02:02:56Z</InsertTime>\n      <LastUpdate>2017-02-07T02:02:56Z</LastUpdate>\n      <DeleteTime>2017-02-20T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-07T02:02:56Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-06T00:18:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-07T00:07:39Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702060018_184D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170206.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170206.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369702891-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170206.he5</GranuleUR>\n      <InsertTime>2017-02-07T02:13:32Z</InsertTime>\n      <LastUpdate>2017-02-07T02:13:32Z</LastUpdate>\n      <DeleteTime>2017-02-20T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-07T02:13:32Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-06T00:18:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-07T00:07:39Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702060018_184D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170206.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170206.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369706131-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"14\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170207.he5</GranuleUR>\n      <InsertTime>2017-02-08T01:07:25Z</InsertTime>\n      <LastUpdate>2017-02-08T01:07:25Z</LastUpdate>\n      <DeleteTime>2017-02-21T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-08T01:07:25Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-07T01:03:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-07T23:12:02Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702070103_191D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170207.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170207.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369785274-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170207.he5</GranuleUR>\n      <InsertTime>2017-02-08T02:47:13Z</InsertTime>\n      <LastUpdate>2017-02-08T02:47:13Z</LastUpdate>\n      <DeleteTime>2017-02-21T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-08T02:47:13Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-07T01:03:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-07T23:12:02Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702070103_191D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170207.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170207.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369784894-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"15\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170208.he5</GranuleUR>\n      <InsertTime>2017-02-09T01:51:40Z</InsertTime>\n      <LastUpdate>2017-02-09T01:51:40Z</LastUpdate>\n      <DeleteTime>2017-02-22T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-09T01:51:40Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-08T00:06:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-08T23:55:22Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702080006_182D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170208.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170208.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369902687-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170208.he5</GranuleUR>\n      <InsertTime>2017-02-09T03:33:08Z</InsertTime>\n      <LastUpdate>2017-02-09T03:33:08Z</LastUpdate>\n      <DeleteTime>2017-02-22T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-09T03:33:08Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-08T00:06:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-08T23:55:22Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702080006_182D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170208.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170208.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369902067-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"15\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170209.he5</GranuleUR>\n      <InsertTime>2017-02-10T02:33:51Z</InsertTime>\n      <LastUpdate>2017-02-10T02:33:51Z</LastUpdate>\n      <DeleteTime>2017-02-23T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-10T02:33:51Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-09T00:51:19Z</BeginningDateTime>\n          <EndingDateTime>2017-02-10T00:38:41Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702090051_189D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170209.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170209.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1370055026-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170209.he5</GranuleUR>\n      <InsertTime>2017-02-10T02:44:32Z</InsertTime>\n      <LastUpdate>2017-02-10T02:44:32Z</LastUpdate>\n      <DeleteTime>2017-02-23T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-10T02:44:32Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-09T00:51:19Z</BeginningDateTime>\n          <EndingDateTime>2017-02-10T00:38:41Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702090051_189D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170209.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170209.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1370057615-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"14\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170210.he5</GranuleUR>\n      <InsertTime>2017-02-11T01:36:42Z</InsertTime>\n      <LastUpdate>2017-02-11T01:36:42Z</LastUpdate>\n      <DeleteTime>2017-02-24T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-11T01:36:42Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-10T01:33:21Z</BeginningDateTime>\n          <EndingDateTime>2017-02-10T23:43:04Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702100133_196D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170210.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170210.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1370128036-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170210.he5</GranuleUR>\n      <InsertTime>2017-02-11T03:23:27Z</InsertTime>\n      <LastUpdate>2017-02-11T03:23:27Z</LastUpdate>\n      <DeleteTime>2017-02-24T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-11T03:23:27Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-10T01:33:21Z</BeginningDateTime>\n          <EndingDateTime>2017-02-10T23:43:04Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702100133_196D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170210.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170210.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      granule_count = Cmr.collection_granule_count("C1000000020-LANCEAMSR2")

      assert_equal(granule_count, 29)
    end

  end

end




